<!-- Tabla administrativa completa de conductores -->
<div class="conductores-admin-container">
  <!-- Header con filtros -->
  <div class="admin-header">
    <div class="header-title">
      <h1>Gesti√≥n Administrativa de Conductores</h1>
      <p>Vista completa de ex√°menes, estad√≠sticas y categor√≠as de por vida</p>
    </div>
    
    <div class="filters-section">
      <div class="search-container">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="onSearchChange($event.target.value)"
          placeholder="Buscar por nombre, DNI o email..."
          class="search-input"
        >
      </div>
      
      <div class="filter-container">
        <select 
          [(ngModel)]="selectedEstado" 
          (change)="onEstadoChange()"
          class="filter-select"
          title="Filtrar por estado"
        >
          <option value="todos">Todos los estados</option>
          <option value="p">Pendiente</option>
          <option value="b">Aprobado</option>
        </select>
      </div>
      
      <div class="filter-container">
        <select 
          [(ngModel)]="selectedExamenEstado" 
          (change)="onExamenEstadoChange()"
          class="filter-select"
          title="Filtrar por estado de ex√°menes"
        >
          <option value="todos">Todos los ex√°menes</option>
          <option value="sin_examenes">Sin ex√°menes</option>
          <option value="con_examenes">Con ex√°menes</option>
          <option value="pendientes">Con pendientes</option>
          <option value="aprobados">Todos aprobados</option>
        </select>
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="btn-secondary" routerLink="/conductores/examenes">
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Gestionar Ex√°menes
      </button>
      <button class="btn-primary" routerLink="/conductores/crear">
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        Nuevo Conductor
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Cargando informaci√≥n de conductores...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error-container">
    <p>{{ error }}</p>
    <button (click)="cargarConductores()" class="btn-retry">Reintentar</button>
  </div>

  <!-- Tabla administrativa -->
  <div *ngIf="!loading && conductoresFiltrados.length > 0" class="admin-table-section">
    <div class="table-header">
      <h2>Tabla Administrativa Completa</h2>
      <span class="count-badge">{{ conductoresFiltrados.length }} conductores</span>
    </div>
    
    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th class="th-conductor">Conductor</th>
            <th class="th-status">Estado</th>
            <th class="th-exams">Ex√°menes Asignados</th>
            <th class="th-stats">Estad√≠sticas de Vida</th>
            <th class="th-categories">Categor√≠as Aprobadas</th>
            <th class="th-pending">Pendientes</th>
            <th class="th-actions">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let conductor of conductoresFiltrados" class="admin-row">
            <!-- Informaci√≥n del Conductor -->
            <td class="td-conductor">
              <div class="conductor-info">
                <div class="conductor-avatar">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <div class="conductor-details">
                  <div class="conductor-name">
                    <span class="name">{{ getConductorNombre(conductor) }}</span>
                    <span class="dni">DNI: {{ getConductorDNI(conductor) }}</span>
                  </div>
                  <div class="conductor-meta">
                    <span class="email">{{ conductor.usuario?.email }}</span>
                    <span class="registro">Registro: {{ formatearFecha(conductor.created_at) }}</span>
                  </div>
                </div>
              </div>
            </td>

            <!-- Estado del Conductor -->
            <td class="td-status">
              <div class="status-info">
                <span class="status-badge" [class]="getEstadoClass(conductor.estado)">
                  {{ getEstadoTexto(conductor.estado) }}
                </span>
                <div class="documentos-info">
                  <small class="documentos-text" *ngIf="conductor.documentos_presentados">
                    üìÑ {{ conductor.documentos_presentados }}
                  </small>
                  <small class="no-documentos" *ngIf="!conductor.documentos_presentados">
                    Sin documentos
                  </small>
                </div>
              </div>
            </td>

            <!-- Ex√°menes Asignados -->
            <td class="td-exams">
              <div class="exam-info">
                <div class="exam-badges" *ngIf="tieneExamenesAsignados(conductor)">
                  <span class="exam-badge exam-total" title="Total de ex√°menes asignados">
                    {{ getTotalExamenes(conductor) }}
                  </span>
                  <span class="exam-badge exam-approved" *ngIf="getExamenesAprobados(conductor) > 0" title="Ex√°menes aprobados">
                    {{ getExamenesAprobados(conductor) }} ‚úì
                  </span>
                  <span class="exam-badge exam-pending" *ngIf="getExamenesPendientes(conductor) > 0" title="Ex√°menes pendientes">
                    {{ getExamenesPendientes(conductor) }} ‚è≥
                  </span>
                </div>
                <div class="exam-status" *ngIf="!tieneExamenesAsignados(conductor)">
                  <span class="no-exams">Sin ex√°menes</span>
                </div>
              </div>
            </td>

            <!-- Estad√≠sticas de Vida -->
            <td class="td-stats">
              <div class="stats-info">
                <div class="stats-summary">
                  <span class="stats-text">{{ getResumenEstadisticas(conductor) }}</span>
                </div>
                <div class="stats-details" *ngIf="getEstadisticasVida(conductor)">
                  <small class="avg-score" *ngIf="getPromedioPuntajeVida(conductor) > 0">
                    Promedio: {{ getPromedioPuntajeVida(conductor) }}%
                  </small>
                  <small class="last-approval" *ngIf="getEstadisticasVida(conductor)?.ultimo_aprobado">
                    √öltimo aprobado: {{ formatearFecha(getEstadisticasVida(conductor)?.ultimo_aprobado) }}
                  </small>
                </div>
              </div>
            </td>

            <!-- Categor√≠as Aprobadas -->
            <td class="td-categories">
              <div class="categories-info">
                <div class="categories-text" *ngIf="getCategoriasAprobadas(conductor).length > 0">
                  {{ getCategoriasTexto(conductor) }}
                </div>
                <div class="no-categories" *ngIf="getCategoriasAprobadas(conductor).length === 0">
                  <span>Sin categor√≠as aprobadas</span>
                </div>
              </div>
            </td>

            <!-- Ex√°menes Pendientes -->
            <td class="td-pending">
              <div class="pending-info">
                <div class="pending-badges" *ngIf="getExamenesHabilitadosNoRealizados(conductor) > 0">
                  <span class="pending-badge" title="Ex√°menes habilitados pero no realizados">
                    {{ getExamenesHabilitadosNoRealizados(conductor) }} üìã
                  </span>
                </div>
                <div class="no-pending" *ngIf="getExamenesHabilitadosNoRealizados(conductor) === 0">
                  <span>Sin pendientes</span>
                </div>
              </div>
            </td>

            <!-- Acciones -->
            <td class="td-actions">
              <div class="action-buttons">
                <button 
                  class="btn-action btn-exam" 
                  [class.btn-disabled]="conductor.estado === 'p'"
                  [disabled]="conductor.estado === 'p'"
                  (click)="abrirModalExamen(conductor)" 
                  [title]="conductor.estado === 'p' ? 'No se puede habilitar examen a conductor pendiente' : 'Habilitar Examen'"
                >
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                </button>
                <button class="btn-action btn-edit" (click)="abrirModal(conductor)" title="Editar">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                </button>
                <button class="btn-action btn-delete" (click)="eliminarConductor(conductor)" title="Eliminar">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination-section" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ Math.min(currentPage * itemsPerPage, totalItems) }} de {{ totalItems }} conductores</span>
      </div>
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="cambiarPagina(currentPage - 1)"
        >
          Anterior
        </button>
        <span 
          *ngFor="let page of getPaginas()" 
          class="pagination-number"
          [class.active]="page === currentPage"
          (click)="cambiarPagina(page)"
        >
          {{ page }}
        </span>
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === totalPages"
          (click)="cambiarPagina(currentPage + 1)"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!loading && conductoresFiltrados.length === 0" class="no-results">
    <div class="no-results-content">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
      <h3>No se encontraron conductores</h3>
      <p>No hay conductores que coincidan con los filtros aplicados</p>
      <button (click)="limpiarFiltros()" class="btn-secondary">Limpiar Filtros</button>
    </div>
  </div>
</div>

<!-- Modal para asignar examen (mantener el existente) -->
<div class="modal-overlay" *ngIf="showExamModal" (click)="cerrarModalExamen()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Habilitar Examen</h2>
      <button class="modal-close" (click)="cerrarModalExamen()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="conductorSeleccionado">
      <div class="conductor-info">
        <h3>{{ getConductorNombre(conductorSeleccionado) }}</h3>
        <p>DNI: {{ getConductorDNI(conductorSeleccionado) }}</p>
      </div>
      
      <div class="form-group">
        <label class="form-label">Seleccionar Examen</label>
        <select class="form-select" [(ngModel)]="examenSeleccionado">
          <option value="">Selecciona un examen</option>
          <option *ngFor="let examen of examenesDisponibles" [ngValue]="examen">
            {{ examen.titulo }} - {{ getDificultadTexto(examen.dificultad) }}
          </option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Intentos Restantes</label>
        <input 
          type="number" 
          class="form-input" 
          [(ngModel)]="intentosRestantes" 
          min="1" 
          max="10"
          placeholder="N√∫mero de intentos"
        >
        <small class="form-hint">N√∫mero de veces que el conductor puede realizar el examen</small>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalExamen()">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="asignarExamen()"
        [disabled]="!examenSeleccionado || intentosRestantes < 1 || loading"
      >
        <span *ngIf="loading">Asignando...</span>
        <span *ngIf="!loading">Habilitar Examen</span>
      </button>
    </div>
  </div>
</div>
