<div class="exam-editor-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <button class="btn-back" (click)="cancelar()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Volver
      </button>
      <h1>Editar Examen</h1>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando examen...</p>
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="success-message">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
    </svg>
    <p>{{ success }}</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <p>{{ error }}</p>
  </div>

  <!-- Form -->
  <div *ngIf="!loading" class="form-container">
    <form (ngSubmit)="actualizarExamen()" #examForm="ngForm">
      <div class="form-section">
        <h3>Información Básica del Examen</h3>
        
        <div class="form-group">
          <label for="titulo">Título del Examen *</label>
          <input 
            type="text" 
            id="titulo" 
            name="titulo"
            [(ngModel)]="examen.titulo" 
            required
            maxlength="200"
            class="form-input"
            placeholder="Ej: Examen de Conducción Básico"
            [class.is-invalid]="error && !examen.titulo.trim()"
          >
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción *</label>
          <textarea 
            id="descripcion" 
            name="descripcion"
            [(ngModel)]="examen.descripcion" 
            required
            maxlength="500"
            rows="4"
            class="form-textarea"
            placeholder="Descripción detallada del examen"
            [class.is-invalid]="error && !examen.descripcion.trim()"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="categorias">Categorías *</label>
          <div class="categorias-container">
            <div *ngFor="let categoria of categorias" class="categoria-checkbox">
              <input 
                type="checkbox" 
                [id]="'cat-' + categoria.categoria_id"
                [value]="categoria.categoria_id"
                [checked]="examen.categorias.includes(categoria.categoria_id)"
                (change)="toggleCategoria(categoria.categoria_id)"
                class="categoria-input"
                [title]="'Seleccionar categoría: ' + categoria.nombre"
                placeholder="Seleccionar categoría"
              >
              <label [for]="'cat-' + categoria.categoria_id" class="categoria-label">
                {{ categoria.nombre }}
              </label>
            </div>
          </div>
          <div *ngIf="error && (!examen.categorias || examen.categorias.length === 0)" class="error-text">
            Debe seleccionar al menos una categoría
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Configuración del Examen</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="tiempo_limite">Tiempo Límite (minutos) *</label>
            <input 
              type="number" 
              id="tiempo_limite" 
              name="tiempo_limite"
              [(ngModel)]="examen.tiempo_limite" 
              required
              min="1"
              max="480"
              class="form-input"
              placeholder="60"
              [class.is-invalid]="error && examen.tiempo_limite <= 0"
            >
          </div>

          <div class="form-group">
            <label for="numero_preguntas">Número de Preguntas *</label>
            <input 
              type="number" 
              id="numero_preguntas" 
              name="numero_preguntas"
              [(ngModel)]="examen.numero_preguntas" 
              required
              min="1"
              max="100"
              class="form-input"
              placeholder="10"
              [class.is-invalid]="error && examen.numero_preguntas <= 0"
            >
          </div>
        </div>

        <div class="form-group">
          <label for="puntaje_minimo">Puntaje Mínimo para Aprobar (%) *</label>
          <input 
            type="number" 
            id="puntaje_minimo" 
            name="puntaje_minimo"
            [(ngModel)]="examen.puntaje_minimo" 
            required
            min="0"
            max="100"
            class="form-input"
            placeholder="70"
            [class.is-invalid]="error && (examen.puntaje_minimo < 0 || examen.puntaje_minimo > 100)"
          >
        </div>

        <div class="form-group">
          <label for="estado">Estado</label>
          <select 
            id="estado" 
            name="estado"
            [(ngModel)]="examen.estado" 
            class="form-select"
          >
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cancelar()" [disabled]="saving">
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="saving || !examForm.form.valid">
          <div *ngIf="saving" class="loading-spinner-small"></div>
          <span *ngIf="!saving">Actualizar Examen</span>
          <span *ngIf="saving">Actualizando...</span>
        </button>
      </div>
    </form>
  </div>
</div> 